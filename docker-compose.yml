services:
  backend:
    build:
      context: ..
      dockerfile: sga-mcp-hub/packages/backend/Dockerfile
    container_name: mcp-claw-backend
    restart: unless-stopped
    ports:
      - '8080:8080'
    environment:
      NODE_ENV: production
      PORT: 8080
      DATABASE_URL: postgres://mcp:mcp_dev@host.docker.internal:5432/mcp_claw_dev
      REDIS_URL: redis://host.docker.internal:6379
      MINIO_ENDPOINT: host.docker.internal
      MINIO_PORT: 9000
      MINIO_ACCESS_KEY: minioadmin
      MINIO_SECRET_KEY: minioadmin
      CORS_ORIGIN: http://localhost:3000
      MASTER_KEY_FILE: /run/secrets/master.key
      MARKET_URL: http://host.docker.internal:3100
    volumes:
      - ./master.key:/run/secrets/master.key:ro
    extra_hosts:
      - "host.docker.internal:host-gateway"

  frontend:
    build:
      context: ..
      dockerfile: sga-mcp-hub/packages/frontend/Dockerfile
    container_name: mcp-claw-frontend
    restart: unless-stopped
    ports:
      - '3010:80'
    depends_on:
      - backend
